# devops/templates/docker/sbom-syft.yml
parameters:
  - name: image
    type: string

steps:
  - script: |
      echo "Generating SBOM for ${{ parameters.image }}..."
      syft ${{ parameters.image }} -o spdx-json=sbom.spdx.json -o cyclonedx-json=sbom.cyclonedx.json -o table=sbom.txt
    displayName: "Generate SBOM"
    condition: succeededOrFailed()

  - task: PublishPipelineArtifact@1
    displayName: "Publish SBOM"
    inputs:
      targetPath: "$(Build.SourcesDirectory)"
      artifact: "sbom-$(Build.BuildId)"
      publishLocation: "pipeline"
      filePatterns: "sbom.*"
    condition: succeededOrFailed()
